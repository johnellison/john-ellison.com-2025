{"version":3,"sources":["../../../../../Sites/john-ellison.com/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || '';\nconst supabaseSecretKey = process.env.SUPABASE_SECRET_KEY || '';\n\nfunction getSupabaseClient() {\n  if (!supabaseUrl || !supabaseSecretKey) {\n    throw new Error('Missing Supabase configuration. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SECRET_KEY.');\n  }\n\n  return createClient(supabaseUrl, supabaseSecretKey);\n}\n\nexport interface Assessment {\n  id: string;\n  created_at: string;\n  company_name: string;\n  website: string;\n  linkedin: string;\n  email: string;\n  dimension_scores: Record<string, number>;\n  overall_score: number;\n  readiness_level: string;\n  blockers: any[];\n  recommendations: any[];\n  company_insights?: any;\n  archetype?: any; // New field\n  axis_scores?: any; // New field\n}\n\nexport async function saveAssessment(assessment: Omit<Assessment, 'id' | 'created_at'>) {\n  try {\n    const supabase = getSupabaseClient();\n    const { data, error } = await supabase\n      .from('assessments')\n      .insert(assessment)\n      .select();\n\n    if (error) {\n      console.error('Error saving assessment:', error);\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data };\n  } catch (err) {\n    console.error('Exception saving assessment:', err);\n    return { success: false, error: String(err) };\n  }\n}\n\nexport interface Lead {\n  id: string;\n  created_at: string;\n  email: string;\n  company_name: string;\n  website: string;\n  linkedin?: string;\n  company_insights?: any;\n  converted_to_assessment: boolean;\n}\n\nexport async function saveLead(lead: Omit<Lead, 'id' | 'created_at' | 'converted_to_assessment'>) {\n  try {\n    const supabase = getSupabaseClient();\n    const { data, error } = await supabase\n      .from('leads')\n      .upsert(\n        { ...lead, converted_to_assessment: false },\n        { onConflict: 'email' }\n      )\n      .select();\n\n    if (error) {\n      console.error('Error saving lead:', error);\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data };\n  } catch (err) {\n    console.error('Exception saving lead:', err);\n    return { success: false, error: String(err) };\n  }\n}\n\nexport async function markLeadConverted(email: string) {\n  try {\n    const supabase = getSupabaseClient();\n    const { error } = await supabase\n      .from('leads')\n      .update({ converted_to_assessment: true })\n      .eq('email', email);\n\n    if (error) {\n      console.error('Error marking lead converted:', error);\n    }\n  } catch (err) {\n    console.error('Exception marking lead converted:', err);\n  }\n}\n\nexport async function getAssessment(id: string) {\n  try {\n    const supabase = getSupabaseClient();\n    const { data, error } = await supabase\n      .from('assessments')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) {\n      console.error('Error fetching assessment:', error);\n      return null;\n    }\n\n    return data;\n  } catch (err) {\n    console.error('Exception fetching assessment:', err);\n    return null;\n  }\n}\n"],"names":[],"mappings":"m/BAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,IAAM,EAAc,YAAA,+BACd,EAAoB,EADkC,MAC1B,GAAG,CAAC,mBAAmB,EAAI,GAE7D,SAAS,IACP,GAAI,CAAC,GAAe,CAAC,EACnB,MAAU,AAAJ,MAAU,KADsB,oFAIxC,MAAO,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,EAAa,EACnC,CAmBO,eAAe,EAAe,CAAiD,EACpF,GAAI,CACF,IAAM,EAAW,IACX,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,eACL,MAAM,CAAC,GACP,MAAM,GAET,GAAI,EAEF,KAFS,EACT,QAAQ,KAAK,CAAC,2BAA4B,GACnC,CAAE,SAAS,EAAO,MAAO,EAAM,OAAO,AAAC,EAGhD,MAAO,CAAE,SAAS,OAAM,CAAK,CAC/B,CAAE,MAAO,EAAK,CAEZ,OADA,QAAQ,KAAK,CAAC,+BAAgC,GACvC,CAAE,SAAS,EAAO,MAAO,OAAO,EAAK,CAC9C,CACF,CAaO,eAAe,EAAS,CAAiE,EAC9F,GAAI,CACF,IAAM,EAAW,IACX,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,SACL,MAAM,CACL,CAAE,GAAG,CAAI,CAAE,yBAAyB,CAAM,EAC1C,CAAE,WAAY,OAAQ,GAEvB,MAAM,GAET,GAAI,EAEF,KAFS,EACT,QAAQ,KAAK,CAAC,qBAAsB,GAC7B,CAAE,QAAS,GAAO,MAAO,EAAM,OAAO,AAAC,EAGhD,MAAO,CAAE,SAAS,OAAM,CAAK,CAC/B,CAAE,MAAO,EAAK,CAEZ,OADA,QAAQ,KAAK,CAAC,yBAA0B,GACjC,CAAE,SAAS,EAAO,MAAO,OAAO,EAAK,CAC9C,CACF"}